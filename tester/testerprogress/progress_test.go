package testerprogress

import (
	"strings"
	"testing"
)

func TestStep(t *testing.T) {
	tests := []struct {
		total  int
		output []string
	}{
		{
			total: 1,
			output: []string{
				"\r[..................................................]100%        1/1\n",
				"\r[..................................................]100%        1/1\n",
			},
		},
		{
			total: 2,
			output: []string{
				"\r[.........................                         ] 50%        1/2",
				"\r[.........................                         ] 50%        1/2\r[..................................................]100%        2/2\n",
				"\r[.........................                         ] 50%        1/2\r[..................................................]100%        2/2\n",
			},
		},
		{
			total: 3,
			output: []string{
				"\r[................                                  ] 33%        1/3",
				"\r[................                                  ] 33%        1/3\r[.................................                 ] 66%        2/3",
				"\r[................                                  ] 33%        1/3\r[.................................                 ] 66%        2/3\r[..................................................]100%        3/3\n",
				"\r[................                                  ] 33%        1/3\r[.................................                 ] 66%        2/3\r[..................................................]100%        3/3\n",
			},
		},
	}

	for i, tt := range tests {
		w := &strings.Builder{}
		b := New(w, tt.total)
		for s := 0; s <= tt.total; s++ {
			b.Step()
			result := w.String()
			if result != tt.output[s] {
				t.Fatalf("%d:%d failed exp \n%s\n, got \n%s\n", i, s, tt.output[s], result)
			}
		}
	}
}
